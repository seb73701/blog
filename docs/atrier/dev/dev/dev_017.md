---
title: Implementing API Security with Auth0
description: 
published: true
date: 2023-04-21T10:31:37.147Z
tags: 
editor: markdown
dateCreated: 2023-04-21T10:31:32.485Z
---

# Implementing API Security with Auth0

We’re going to use the Auth0 online platform for our API security. We’ll need to log in (or sign up) at the website, define our API in the Auth0 system, and collect key authentication parameters that we’ll need in order to access the secured API (for example, our access token). We’ll also learn how to validate access tokens with the JWT.io website.[86](https://medium.com/pragmatic-programmers/chapter-exercise-4ba456e7d4f9)
Once we have that taken care of, we can modify our API service to support secure connections, and then we can test that using the access token supplied by Auth0. But first, let’s log in to our security provider and define our secure API.

## Logging In to Auth0
The first step in adding security to our API will be to log in to Auth0.[87](https://medium.com/@pragprog/chapter-exercise-4ba456e7d4f9) I like using Auth0 because you can start small and build up a more complex security profile as you need it. Your company may be using a different external service, or you may want to implement one of your own. The important thing here is to understand the key concepts so that you can translate them to your own environment.
If you already have an Auth0 account, just go to the home page and click the Login button. If you need to create an account, visit the Sign Up page to get started.[88](https://medium.com/@pragprog/chapter-exercise-4ba456e7d4f9)
Once you sign up, you’ll see your main Auth0 dashboard, as shown in the first screenshot. We’ll use this screen quite a bit throughout this chapter.
![](https://miro.medium.com/proxy/1*m45EgZlph_zhYYtDg359ng.png)

## Defining Your API
On the main Auth0 dashboard, several options appear in the menu on the left side of the screen. Click the APIs option to bring up the list of defined APIs. (You might not see any if this is your first login at Auth0.)
To define your API, click the Create Application button that appears in the top-right corner of the screen. That brings up the New API dialog box, shown in the second screenshot.

![](https://miro.medium.com/proxy/1*qRMDZDsx96YLv8-N4yuILw.png)

First, enter the name of the API you wish to define. For this example, we’ll use bigco-company. (This is just a text field that you can change later.) The next field you need to fill in is the Identifier field. You can enter any unique value here (no spaces). It’s common practice to use a URI in this field. For this example, we’ll supply http://mamund.com/bigco-company. Leave the Signing Algorithm text field set to the default value and press the Create button.
After clicking Create, you’ll see the landing page for the bigco-company API. Your API is now defined in Auth0. You just need to collect some key parameters generated by Auth0, and then you’ll be ready to test your new credentials and generate an API access token.

## Collecting API Identity Parameters
When you defined your API at Auth0, it created a handful of important parameters you’ll need to keep track of when you update your API service to check for access tokens and to use a client app to send the access token when calling the API service. Let’s go through the values you need to keep track of and then we’ll talk about how to use them.
First, on the Auth0 website, go to your APIs page (through the link located in the menu on the left) and select the API we just created (bigco-company). You should now see the landing page for the bigco-company API. Select the Settings tab and note the Name (bigco-company) and Identifier (http://mamund.com/bigco-company) values. Copy these to a text file named auth0.env and save that file to a new subfolder in your project named security/. We’ll use this folder to hold a number of important security-related files and scripts.
Next, select the Applications option from the menu on the left and, when the list of applications appears, select bigco-company (Test Application) in the list, which was automatically created when you defined your API earlier. Clicking the name of the application brings up the application landing page with the Settings tab selected. It will look similar to the screen shown.

![](https://miro.medium.com/proxy/1*h2PAFP2Lnu2XI1ow7AhhxA.png)

From this screen, copy and paste the domain, client ID, and client secret values into your auth0.env text file.

## Our Little Secret
WARNING
![](https://miro.medium.com/1*6CqXm-5UyCBHShlzk2faYA.png)
Be very careful with these API parameter values, especially the client secret. Anyone who has access to this information can create a valid access token and interact with your API.

Using the five parameter values you’ve collected (name, identifier, domain, client ID, and client secret), complete your auth0.env file using the template that follows as a guide:
[ch10-securing/auth0.txt](http://media.pragprog.com/titles/maapis/code/ch10-securing/auth0.txt)
​
```ini 
 ###################################################
​ # auth0.env environment vars for bigco-company API
​ ###################################################
​ 
​ name="<NAME>"
​ 
​ id="<CLIENT ID>"
​ secret="<CLIENT SECRET>"
​ 
​ url="<DOMAIN>/oauth/token"
​ 
​ jwksuri="<DOMAIN>/.well-known/jwks.json"
​ audience="<IDENTIFIER>"
​ issuer="<DOMAIN>"
​ 
​ ### EOF
```

Now we can use this file in some scripts later to generate valid access tokens and test the security of your API. The id, secret, and audience parameters will be used by client apps to generate new access tokens. The url, wjksuri, audience, and issuer parameters will be used by your API service to communicate with Auth0 and validate the access token passed to the service by the client apps.
Now let’s generate our first access token for the bigco-company API.

## Generating Your Access Token
Your client applications will need a valid access token in order to communicate with your secured API service. For human-driven apps (like mobile browser apps), this access token is generated when the human enters his or her username and password (also called their credentials). But our API won’t be talking directly to a human, it’ll be talking to another application — another machine. For this reason, this kind of API security profile is referred to as “machine-to-machine” interaction.
To get a valid access token for a machine application, we need to generate that token ahead of time. This is the replacement for a login dialog. An example of how to do this with curl is shown here:
[ch10-securing/generate-token.txt](http://media.pragprog.com/titles/maapis/code/ch10-securing/generate-token.txt)
```bash
​ curl --request POST \
​   --url <DOMAIN>/oauth/token \
​   --header 'content-type: application/json' \
​   --data '{"client_id":"<CLIENT ID>",
​            "client_secret":"<CLIENT SECRET>",
​            "audience":"<AUDIENCE>",
​            "grant_type":"client_credentials"
​           }'
```

Notice you need to insert values from the auth0.env file into this single curl command. Also notice the use of the “grant_type”:”client_credentials” parameter in the body posted to Auth0. There are several possible ways (grant types) to complete an access token request. In this book we’ll use the client_credential method.
When you execute this command, you’re contacting the Auth0 server and asking it to generate an access token for future API calls. The HTTP response you’ll get from Auth0 will look like this:
[ch10-securing/access-token.json](http://media.pragprog.com/titles/maapis/code/ch10-securing/access-token.json)
```json
​ {
​   ​"access_token"​: ​"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCI..."​,
​   ​"token_type"​: ​"Bearer"​
​ }
```

Your access_token value will be a very long encoded string. I included a few of the characters in the book. We’ll need to copy this really long string into each and every API request in order to be able to access a secured API service. (More on that in the next section of this chapter.) For now, be sure to copy and paste this value into a text file because we have one more step to go before we’re done with our access token — we need to validate it.

## Validating Your Access Token
Access tokens from the Auth0 website are based on the JSON Web Token (JWT) specifications (RFC7519).[89](https://medium.com/@pragprog/chapter-exercise-4ba456e7d4f9) JWTs are encoded tokens that contain three parts: a header, a body, and a signature. You can actually decode the contents of a JSON Web Token too. This can come in handy when you want to validate or debug a token that doesn’t seem to be working as expected.
You’ll find a JWT decoder at the JWT.io website,[90](https://medium.com/@pragprog/chapter-exercise-4ba456e7d4f9) which is operated by Auth0. To see what’s encoded into a JWT, copy and paste the access token you generated in the previous section of the book into the decoder at jwt.io. When you do, you should see something similar to what’s shown in this screenshot:

![](https://miro.medium.com/proxy/1*J1aZNhvDQ684cJZ6fMVAzw.png)

Now you know how to generate and, if needed, validate JWT access tokens. Next we’ll update one of our BigCo APIs to support machine-to-machine authentication using our JWT tokens.

## Reading Assignment
INFORMATION

![](https://miro.medium.com/1*hdurJSus6cZRiDs9M6oJ3A.png)

There isn’t enough room in this chapter to explain all the details of a JWT, but you’ll find lots of information at the https://jwt.io website and the related RFC7519 specification document.

Source : https://medium.com/pragmatic-programmers/implementing-api-security-with-auth0-b50ad4fa77eb


